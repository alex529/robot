\hypertarget{card_8c}{\section{Car Charger Station/card.c File Reference}
\label{card_8c}\index{Car Charger Station/card.\+c@{Car Charger Station/card.\+c}}
}
{\ttfamily \#include $<$stdbool.\+h$>$}\\*
{\ttfamily \#include $<$string.\+h$>$}\\*
{\ttfamily \#include \char`\"{}task.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}timer.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}spi.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}common.\+h\char`\"{}}\\*
{\ttfamily \#include \char`\"{}Lcd\+Screen.\+h\char`\"{}}\\*
\subsection*{Classes}
\begin{DoxyCompactItemize}
\item 
union \hyperlink{unioncard__t}{card\+\_\+t}
\end{DoxyCompactItemize}
\subsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\hypertarget{card_8c_ae66027f0e0f815f9091ca2cb0d82144b}{\#define {\bfseries C\+O\+M\+M\+A\+N\+D\+\_\+\+G\+E\+T\+\_\+\+U\+I\+D}~0x55}\label{card_8c_ae66027f0e0f815f9091ca2cb0d82144b}

\item 
\hypertarget{card_8c_ad2468a220418dd7e9bd9e18201b87bd0}{\#define {\bfseries C\+O\+M\+M\+A\+N\+D\+\_\+\+D\+U\+M\+M\+Y}~0xf5}\label{card_8c_ad2468a220418dd7e9bd9e18201b87bd0}

\item 
\hypertarget{card_8c_a6f6489887e08bff4887d0bc5dcf214d8}{\#define {\bfseries A\+C\+K}~0x86}\label{card_8c_a6f6489887e08bff4887d0bc5dcf214d8}

\item 
\hypertarget{card_8c_a23c4cdf5b9ee6cdcc9ed439559987c7c}{\#define {\bfseries L\+E\+N\+G\+T\+H\+\_\+\+O\+F\+\_\+\+C\+A\+R\+D\+\_\+\+U\+I\+D}~7}\label{card_8c_a23c4cdf5b9ee6cdcc9ed439559987c7c}

\item 
\#define \hyperlink{card_8c_a69424f36d4ef2c486b3837f8aedbdc28}{send\+\_\+card1\+\_\+task}()~\{card.\+data.\+command = S\+E\+N\+D\+\_\+\+C\+A\+R\+D1;	card.\+data.\+value = U\+I\+D.\+u32\mbox{[}0\mbox{]};	add\+\_\+task(\&card);\}
\item 
\#define \hyperlink{card_8c_a81951fda998209d6726768fd4509edad}{send\+\_\+card2\+\_\+task}()~\{card.\+data.\+command = S\+E\+N\+D\+\_\+\+C\+A\+R\+D2;	card.\+data.\+value = U\+I\+D.\+u32\mbox{[}1\mbox{]};	add\+\_\+task(\&card);\}
\item 
\#define \hyperlink{card_8c_afd5fa00d0d543e01dfc33c8bf3589fa8}{send\+\_\+card\+\_\+valid}()~\{card.\+data.\+command = C\+A\+R\+D\+\_\+\+V\+A\+L\+I\+D;	card.\+data.\+value = 0;			add\+\_\+task(\&card);\}
\end{DoxyCompactItemize}
\subsection*{Functions}
\begin{DoxyCompactItemize}
\item 
void \hyperlink{card_8c_a341a436e28063bdbb67085919c94e331}{get\+\_\+\+U\+I\+D} (char $\ast$U\+I\+D)
\begin{DoxyCompactList}\small\item\em will populate the array with the U\+I\+D of the card. if the card is not available the array will be populated with 0x00-\/values \end{DoxyCompactList}\item 
void \hyperlink{card_8c_a961e450e662446efe99f62cfd4cb3eba}{read\+\_\+card} (void)
\begin{DoxyCompactList}\small\item\em Checks if a valid card is supplied, if yes the first 32bit off the id are send to the task queue. \end{DoxyCompactList}\item 
void \hyperlink{card_8c_aa7be70c6f1fa73c4e84b0cd877907fb0}{ack\+\_\+card1} (\hyperlink{uniontask__t}{task\+\_\+t} $\ast$task)
\begin{DoxyCompactList}\small\item\em Check if the server didn't receive corrupted data and if it didn't the second part of the U\+I\+D is supplied. \end{DoxyCompactList}\item 
void \hyperlink{card_8c_a9cbf45c448349124999cadaadc5387ee}{ack\+\_\+card2} (\hyperlink{uniontask__t}{task\+\_\+t} $\ast$task)
\begin{DoxyCompactList}\small\item\em Check if the server didn't receive corrupted data and if it didn't the M\+C\+U asks if the card U\+I\+D is valid. \end{DoxyCompactList}\item 
void \hyperlink{card_8c_aea2d2b8966d7709dda5f91571be59b61}{ack\+\_\+card\+\_\+valid} (\hyperlink{uniontask__t}{task\+\_\+t} $\ast$task)
\begin{DoxyCompactList}\small\item\em Checs if the card is vaild. \end{DoxyCompactList}\end{DoxyCompactItemize}
\subsection*{Variables}
\begin{DoxyCompactItemize}
\item 
\hypertarget{card_8c_a5b6c3657bd509edebe4b6be3b8304da5}{\hyperlink{unioncard__t}{card\+\_\+t} {\bfseries U\+I\+D}}\label{card_8c_a5b6c3657bd509edebe4b6be3b8304da5}

\item 
\hypertarget{card_8c_abb2e1bdd2cb6387295f09ee1f9f79bcf}{\hyperlink{uniontask__t}{task\+\_\+t} {\bfseries card} = \{.data.\+command = S\+E\+N\+D\+\_\+\+C\+A\+R\+D1, .data.\+value = 0\}}\label{card_8c_abb2e1bdd2cb6387295f09ee1f9f79bcf}

\item 
\hypertarget{card_8c_af797cbeea9dece2a8facf5d545c0d93c}{\hyperlink{structtimer__t}{timer\+\_\+t} {\bfseries card\+\_\+delay\+\_\+timer}}\label{card_8c_af797cbeea9dece2a8facf5d545c0d93c}

\end{DoxyCompactItemize}


\subsection{Detailed Description}
!

Author\+: Adam Orosz 

\subsection{Macro Definition Documentation}
\hypertarget{card_8c_a69424f36d4ef2c486b3837f8aedbdc28}{\index{card.\+c@{card.\+c}!send\+\_\+card1\+\_\+task@{send\+\_\+card1\+\_\+task}}
\index{send\+\_\+card1\+\_\+task@{send\+\_\+card1\+\_\+task}!card.\+c@{card.\+c}}
\subsubsection[{send\+\_\+card1\+\_\+task}]{\setlength{\rightskip}{0pt plus 5cm}\#define send\+\_\+card1\+\_\+task(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)~\{card.\+data.\+command = S\+E\+N\+D\+\_\+\+C\+A\+R\+D1;	card.\+data.\+value = U\+I\+D.\+u32\mbox{[}0\mbox{]};	add\+\_\+task(\&card);\}}}\label{card_8c_a69424f36d4ef2c486b3837f8aedbdc28}
Sets up the card task for sending the first half of the U\+I\+D and adds it to the queue. \hypertarget{card_8c_a81951fda998209d6726768fd4509edad}{\index{card.\+c@{card.\+c}!send\+\_\+card2\+\_\+task@{send\+\_\+card2\+\_\+task}}
\index{send\+\_\+card2\+\_\+task@{send\+\_\+card2\+\_\+task}!card.\+c@{card.\+c}}
\subsubsection[{send\+\_\+card2\+\_\+task}]{\setlength{\rightskip}{0pt plus 5cm}\#define send\+\_\+card2\+\_\+task(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)~\{card.\+data.\+command = S\+E\+N\+D\+\_\+\+C\+A\+R\+D2;	card.\+data.\+value = U\+I\+D.\+u32\mbox{[}1\mbox{]};	add\+\_\+task(\&card);\}}}\label{card_8c_a81951fda998209d6726768fd4509edad}
Sets up the card task for sending the second half of the U\+I\+D and adds it to the queue. \hypertarget{card_8c_afd5fa00d0d543e01dfc33c8bf3589fa8}{\index{card.\+c@{card.\+c}!send\+\_\+card\+\_\+valid@{send\+\_\+card\+\_\+valid}}
\index{send\+\_\+card\+\_\+valid@{send\+\_\+card\+\_\+valid}!card.\+c@{card.\+c}}
\subsubsection[{send\+\_\+card\+\_\+valid}]{\setlength{\rightskip}{0pt plus 5cm}\#define send\+\_\+card\+\_\+valid(
\begin{DoxyParamCaption}
{}
\end{DoxyParamCaption}
)~\{card.\+data.\+command = C\+A\+R\+D\+\_\+\+V\+A\+L\+I\+D;	card.\+data.\+value = 0;			add\+\_\+task(\&card);\}}}\label{card_8c_afd5fa00d0d543e01dfc33c8bf3589fa8}
Sets up the card task for asking if the card is valid and adds it to the queue. 

\subsection{Function Documentation}
\hypertarget{card_8c_aa7be70c6f1fa73c4e84b0cd877907fb0}{\index{card.\+c@{card.\+c}!ack\+\_\+card1@{ack\+\_\+card1}}
\index{ack\+\_\+card1@{ack\+\_\+card1}!card.\+c@{card.\+c}}
\subsubsection[{ack\+\_\+card1}]{\setlength{\rightskip}{0pt plus 5cm}void ack\+\_\+card1 (
\begin{DoxyParamCaption}
\item[{{\bf task\+\_\+t} $\ast$}]{task}
\end{DoxyParamCaption}
)}}\label{card_8c_aa7be70c6f1fa73c4e84b0cd877907fb0}


Check if the server didn't receive corrupted data and if it didn't the second part of the U\+I\+D is supplied. 


\begin{DoxyParams}{Parameters}
{\em task} & Used to specify a pointer to an appropriate task.\\
\hline
\end{DoxyParams}
Alexandru

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\hypertarget{card_8c_a9cbf45c448349124999cadaadc5387ee}{\index{card.\+c@{card.\+c}!ack\+\_\+card2@{ack\+\_\+card2}}
\index{ack\+\_\+card2@{ack\+\_\+card2}!card.\+c@{card.\+c}}
\subsubsection[{ack\+\_\+card2}]{\setlength{\rightskip}{0pt plus 5cm}void ack\+\_\+card2 (
\begin{DoxyParamCaption}
\item[{{\bf task\+\_\+t} $\ast$}]{task}
\end{DoxyParamCaption}
)}}\label{card_8c_a9cbf45c448349124999cadaadc5387ee}


Check if the server didn't receive corrupted data and if it didn't the M\+C\+U asks if the card U\+I\+D is valid. 


\begin{DoxyParams}{Parameters}
{\em task} & Used to specify a pointer to an appropriate task.\\
\hline
\end{DoxyParams}
Alexandru

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\hypertarget{card_8c_aea2d2b8966d7709dda5f91571be59b61}{\index{card.\+c@{card.\+c}!ack\+\_\+card\+\_\+valid@{ack\+\_\+card\+\_\+valid}}
\index{ack\+\_\+card\+\_\+valid@{ack\+\_\+card\+\_\+valid}!card.\+c@{card.\+c}}
\subsubsection[{ack\+\_\+card\+\_\+valid}]{\setlength{\rightskip}{0pt plus 5cm}void ack\+\_\+card\+\_\+valid (
\begin{DoxyParamCaption}
\item[{{\bf task\+\_\+t} $\ast$}]{task}
\end{DoxyParamCaption}
)}}\label{card_8c_aea2d2b8966d7709dda5f91571be59b61}


Checs if the card is vaild. 


\begin{DoxyParams}{Parameters}
{\em task} & Used to specify a pointer to an appropriate task.\\
\hline
\end{DoxyParams}
Alexandru

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\hypertarget{card_8c_a341a436e28063bdbb67085919c94e331}{\index{card.\+c@{card.\+c}!get\+\_\+\+U\+I\+D@{get\+\_\+\+U\+I\+D}}
\index{get\+\_\+\+U\+I\+D@{get\+\_\+\+U\+I\+D}!card.\+c@{card.\+c}}
\subsubsection[{get\+\_\+\+U\+I\+D}]{\setlength{\rightskip}{0pt plus 5cm}void get\+\_\+\+U\+I\+D (
\begin{DoxyParamCaption}
\item[{char $\ast$}]{U\+I\+D}
\end{DoxyParamCaption}
)}}\label{card_8c_a341a436e28063bdbb67085919c94e331}


will populate the array with the U\+I\+D of the card. if the card is not available the array will be populated with 0x00-\/values 


\begin{DoxyParams}{Parameters}
{\em U\+I\+D} & char, 7 long\\
\hline
\end{DoxyParams}
Adam Orosz

\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
\hypertarget{card_8c_a961e450e662446efe99f62cfd4cb3eba}{\index{card.\+c@{card.\+c}!read\+\_\+card@{read\+\_\+card}}
\index{read\+\_\+card@{read\+\_\+card}!card.\+c@{card.\+c}}
\subsubsection[{read\+\_\+card}]{\setlength{\rightskip}{0pt plus 5cm}void read\+\_\+card (
\begin{DoxyParamCaption}
\item[{void}]{}
\end{DoxyParamCaption}
)}}\label{card_8c_a961e450e662446efe99f62cfd4cb3eba}


Checks if a valid card is supplied, if yes the first 32bit off the id are send to the task queue. 


\begin{DoxyParams}{Parameters}
{\em } & Author Alexandru\\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
void 
\end{DoxyReturn}
